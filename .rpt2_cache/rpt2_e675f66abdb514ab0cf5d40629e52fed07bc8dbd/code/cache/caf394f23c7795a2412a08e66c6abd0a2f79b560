{"map":"{\"version\":3,\"file\":\"baseTrace.js\",\"sourceRoot\":\"\",\"sources\":[\"../../src/baseTrace.ts\"],\"names\":[],\"mappings\":\"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\"}","code":"import { __assign } from \"tslib\";\nimport { onVitals, mapMetric, generateUniqueId } from './core/webvitals';\nimport interceptFetch from './core/fetch';\nimport { dataCategory2BreadcrumbsCategory, dataTypes2BreadcrumbsType, getPerfLevel, getTimestamp, getTraceDataLevel, getTraceDataType, hashCode, isResourceTarget, uuid } from './core/util';\nimport { BreadcrumbTypes, BreadcrumbsCategorys, BrowserType, TraceClientTypes, TraceDataSeverity, TraceDataTypes, TraceLevelType, TraceTypes } from './typings/common';\nimport { getFingerprintId } from './core/fingerprint';\nimport { sendByImg } from './core/send';\nvar BaseTrace = /** @class */ (function () {\n    function BaseTrace(options) {\n        var _this = this;\n        // 日志上报后端API\n        this.dsn = '';\n        // 页面ID\n        this.pageId = '';\n        //\n        this.userAgent = navigator.userAgent;\n        //\n        this.browserType = BrowserType.MOBILE;\n        // fingerprintId\n        this.fpId = '';\n        // user id\n        this.uid = '';\n        // appId\n        this.appId = '';\n        // 是否开启debug状态\n        this.debug = true;\n        // 性能日志数据\n        this.perfData = {\n            id: ''\n        };\n        // 存储错误资源数据\n        this.resources = [];\n        this.result = {};\n        // 记录用户行为\n        this.breadcrumb = [];\n        // 最大存储用户行为\n        this.maxBreadcrumb = 10;\n        // 是否开启用户行为\n        this.breadcrumbEnabled = true;\n        this.observer = null;\n        // 存储链路日志数据\n        this.queue = [];\n        // 发送请求时间间隔\n        this.sendTimer = 1000;\n        console.log('BaseTrace constructor.');\n        this.pageId = uuid();\n        this.dsn = options.dsn;\n        this.appId = options.appId;\n        this.debug = !!options.debug;\n        this.perfData = {\n            id: generateUniqueId()\n        };\n        this.fpId = getFingerprintId('TraceCourse');\n        this.observer = new PerformanceObserver(function (list, observer) {\n            list.getEntries().forEach(function (entry) {\n                _this.debug && console.debug(\"name    : \".concat(entry.name));\n                _this.debug && console.debug(\"type    : \".concat(entry.entryType));\n                _this.debug && console.debug(\"duration: \".concat(entry.duration));\n                if (entry.entryType === 'resource') {\n                    _this.handleObserverResource(entry);\n                }\n            });\n        });\n    }\n    BaseTrace.prototype.log = function (log) {\n        this.saveBreadcrumb({\n            name: 'customer-log',\n            level: log.level,\n            type: dataTypes2BreadcrumbsType(log.type),\n            category: dataCategory2BreadcrumbsCategory(log.type),\n            message: JSON.stringify(log.message),\n            time: getTimestamp(),\n        });\n        this.debug && console.debug(\"log: \".concat(JSON.stringify(log)));\n        this.send(log);\n    };\n    BaseTrace.prototype.info = function (message, tag) {\n        this.log({\n            name: 'customer-info',\n            type: TraceDataTypes.LOG,\n            level: TraceDataSeverity.Info,\n            message: message,\n            time: getTimestamp(),\n            dataId: hashCode(\"\".concat(message, \"|\").concat(tag || '')),\n            tag: tag,\n        });\n    };\n    BaseTrace.prototype.warn = function (message, tag) {\n        this.log({\n            name: 'customer-warning',\n            type: TraceDataTypes.LOG,\n            level: TraceDataSeverity.Warning,\n            message: message,\n            time: getTimestamp(),\n            dataId: hashCode(\"\".concat(message, \"|\").concat(tag || '')),\n            tag: tag,\n        });\n    };\n    BaseTrace.prototype.error = function (message, tag) {\n        this.log({\n            name: 'customer-error',\n            type: TraceDataTypes.LOG,\n            level: TraceDataSeverity.Error,\n            message: message,\n            time: getTimestamp(),\n            dataId: hashCode(\"\".concat(message, \"|\").concat(tag || '')),\n            tag: tag,\n        });\n    };\n    BaseTrace.prototype.setTraceData = function (data) {\n        var type = TraceTypes.CONSOLE;\n        var level = TraceLevelType.Debug;\n        var _data = null;\n        var perf = null;\n        if (!!data.dataId) {\n            type = getTraceDataType(data.type);\n            level = getTraceDataLevel(data.level);\n            _data = data;\n        }\n        if (!!data.id) {\n            type = TraceTypes.PERF;\n            level = getPerfLevel(data);\n            perf = data;\n        }\n        var traceData = {\n            type: type,\n            level: level,\n            createdAt: getTimestamp(),\n            updatedAt: getTimestamp(),\n            data: _data,\n            perf: perf,\n            breadcrumbs: this.breadcrumb,\n            traceId: uuid(),\n            ua: this.userAgent,\n            bt: this.browserType,\n            fpId: this.fpId,\n            appId: this.appId,\n            clientType: TraceClientTypes.BROWSER_H5,\n            url: document.URL,\n            pid: this.pageId,\n            uid: this.uid,\n        };\n        this.debug && console.log('[setTraceData]traceData: ', traceData);\n        return traceData;\n    };\n    BaseTrace.prototype.send = function (data) {\n        var traceData = this.setTraceData(data);\n        sendByImg(this.dsn, traceData);\n    };\n    BaseTrace.prototype.createPerfReport = function () {\n        var _this = this;\n        var report = function (metric) {\n            _this.perfData = __assign(__assign({}, _this.perfData), mapMetric(metric));\n        };\n        setTimeout(function () {\n            var supportedEntryTypes = (PerformanceObserver && PerformanceObserver.supportedEntryTypes) || [];\n            var isLatestVisibilityChangeSupported = supportedEntryTypes.indexOf('layout-shift') !== -1;\n            if (isLatestVisibilityChangeSupported) {\n                var onVisibilityChange = function () {\n                    if (document.visibilityState === 'hidden') {\n                        console.log('this.send', _this.perfData);\n                        _this.send(_this.perfData);\n                        // removeEventListener('visibilitychange', onVisibilityChange, true)\n                    }\n                };\n                addEventListener('visibilitychange', onVisibilityChange, true);\n            }\n            else {\n                addEventListener('pagehide', function () {\n                    console.log('pagehide', _this.perfData);\n                    _this.send(_this.perfData);\n                }, { capture: true, once: true });\n            }\n        });\n        return report;\n    };\n    BaseTrace.prototype.saveError = function (event) {\n        console.log('[onResourceError] event: ', event);\n        var target = event.target || event.srcElement;\n        var isResTarget = isResourceTarget(target);\n        if (!isResTarget) {\n            var traceData = {\n                dataId: hashCode(\"\".concat(event.type, \"-\").concat(event.error.stack)),\n                name: 'script-error',\n                level: TraceDataSeverity.Error,\n                message: event.message,\n                time: getTimestamp(),\n                type: TraceDataTypes.JAVASCRIPT,\n                stack: event.error.stack\n            };\n            this.resources.push(traceData);\n            this.breadcrumb.push({\n                name: event.error.name,\n                type: BreadcrumbTypes.CODE_ERROR,\n                category: BreadcrumbsCategorys.Exception,\n                level: TraceDataSeverity.Error,\n                message: JSON.stringify(event.message),\n                stack: event.error.stack,\n                time: getTimestamp()\n            });\n            this.queue.push(this.setTraceData(traceData));\n        }\n        else {\n            var url = target.getAttribute('src') || target.getAttribute('href');\n            var traceData = {\n                dataId: hashCode(\"\".concat(target.nodeName.toLowerCase(), \"-\").concat(event.message).concat(url)),\n                name: 'resource-load-error',\n                level: TraceDataSeverity.Warning,\n                message: event.message,\n                time: getTimestamp(),\n                type: TraceDataTypes.RESOURCE,\n                stack: null\n            };\n            this.resources.push(traceData);\n            this.breadcrumb.push({\n                name: traceData.name,\n                type: BreadcrumbTypes.RESOURCE,\n                category: BreadcrumbsCategorys.Exception,\n                level: TraceDataSeverity.Warning,\n                message: JSON.stringify(event.message),\n                time: getTimestamp()\n            });\n            this.queue.push(this.setTraceData(traceData));\n        }\n    };\n    BaseTrace.prototype.handleObserverResource = function (entry) {\n        if (entry.entryType === 'resource') {\n            var level = TraceDataSeverity.Info;\n            if (entry.duration > 1000 && entry.duration < 1500) {\n                level = TraceDataSeverity.Warning;\n            }\n            else if (entry.duration > 1500) {\n                level = TraceDataSeverity.Error;\n            }\n            entry.duration > 1000 && this.resources.push({\n                url: entry.name,\n                name: \"\".concat(entry.entryType, \"-duration-\").concat(entry.initiatorType),\n                type: TraceDataTypes.PERF,\n                level: level,\n                message: \"duration:\".concat(Math.round(entry.duration)),\n                time: getTimestamp(),\n                dataId: hashCode(\"\".concat(entry.entryType, \"-\").concat(entry.name)),\n            });\n        }\n    };\n    // 这里的构造数据有问题，后续需要更新\n    BaseTrace.prototype.onFetchError = function (message) {\n        console.log('[onFetchError] message: ', message);\n        var traceBaseData = {\n            dataId: hashCode(\"\".concat(message.url, \"-\").concat(message.method, \"-\").concat(message.status, \"-\").concat(message.statusText)),\n            name: 'fetch-error',\n            level: TraceDataSeverity.Critical,\n            message: '',\n            time: getTimestamp(),\n            type: TraceDataTypes.HTTP\n        };\n        var errorData = __assign(__assign({}, traceBaseData), { url: message.url, status: message.status, message: message.statusText, method: message.method, body: message.body, elapsedTime: message.elapsedTime, httpType: 'fetch' });\n        console.log('error data: ', errorData);\n        this.queue.push(this.setTraceData(errorData));\n    };\n    BaseTrace.prototype.onGlobalError = function () {\n        var _t = this;\n        console.log('onGlobalError');\n        window.addEventListener('error', function (event) {\n            _t.saveError(event);\n        });\n        window.addEventListener('unhandledrejection', function (event) {\n            // _t.saveError(event)\n            console.log(event, event instanceof PromiseRejectionEvent);\n            if (event instanceof PromiseRejectionEvent) {\n                var errorEvent = new ErrorEvent(\"promiseRejection\", {\n                    message: event.reason.toString(),\n                    // filename: event.filename,\n                    // lineno: event.lineno,\n                    // colno: event.colno,\n                    error: event.reason,\n                });\n                _t.saveError(errorEvent);\n            }\n            else if (event instanceof ErrorEvent) {\n                _t.saveError(event);\n            }\n        });\n    };\n    BaseTrace.prototype.onGlobalClick = function () {\n        var _this = this;\n        var _t = this;\n        window.addEventListener('click', function (event) {\n            var target = event.target;\n            var innerHTML = target.innerHTML;\n            var bc = {\n                name: 'click',\n                level: TraceDataSeverity.Normal,\n                type: BreadcrumbTypes.CLICK,\n                category: BreadcrumbsCategorys.User,\n                message: JSON.stringify(innerHTML),\n                time: getTimestamp()\n            };\n            _this.saveBreadcrumb(bc);\n        });\n    };\n    BaseTrace.prototype.onObserverResource = function () {\n        var _t = this;\n        // const observer = new PerformanceObserver((list, observer) => {\n        //   list.getEntries().forEach((entry) => {\n        //     console.log(`name    : ${entry.name}`);\n        //     console.log(`type    : ${entry.entryType}`);\n        //     console.log(`duration: ${entry.duration}`);\n        //     _t.handleObserverResource(entry)\n        //   });\n        // });\n        // observer.observe({\n        //   entryTypes: [\"resource\"],\n        // });\n    };\n    BaseTrace.prototype.saveBreadcrumb = function (data) {\n        if (this.breadcrumbEnabled) {\n            this.breadcrumb.push(data);\n            if (this.breadcrumb.length > this.maxBreadcrumb) {\n                this.breadcrumb.shift();\n            }\n        }\n    };\n    BaseTrace.prototype.setUserId = function (userId) {\n        this.uid = userId;\n    };\n    // 初始化实例\n    BaseTrace.init = function (options) {\n        var traceSdk = new BaseTrace(options);\n        // 监听全局报错信息\n        traceSdk.onGlobalError();\n        // traceSdk.onObserverResource()\n        traceSdk.observer.observe({\n            entryTypes: [\"resource\"],\n        });\n        // 拦截Fetch\n        window.fetch = interceptFetch({\n            pagePath: '',\n            onError: function (error) {\n                traceSdk.onFetchError(error);\n            },\n            onBefore: function (props) {\n                traceSdk.saveBreadcrumb({\n                    name: 'fetch',\n                    level: TraceDataSeverity.Normal,\n                    type: BreadcrumbTypes.FETCH,\n                    category: BreadcrumbsCategorys.Http,\n                    message: props.url,\n                    time: getTimestamp(),\n                    request: {\n                        method: props.method,\n                        url: props.url,\n                        options: props.options\n                    }\n                });\n            },\n            onAfter: function (result) {\n                traceSdk.saveBreadcrumb({\n                    name: 'fetch',\n                    level: TraceDataSeverity.Normal,\n                    type: BreadcrumbTypes.FETCH,\n                    category: BreadcrumbsCategorys.Http,\n                    message: result.status,\n                    time: getTimestamp(),\n                    response: {\n                        status: result.status,\n                        statusText: result.statusText\n                    }\n                });\n            }\n        });\n        // 监听页面性能\n        onVitals(traceSdk.createPerfReport());\n        // 定时发送页面数据\n        setInterval(function () {\n            var data = traceSdk.queue.shift();\n            if (data)\n                sendByImg(traceSdk.dsn, data);\n        }, traceSdk.sendTimer);\n        // @ts-ignore\n        window.traceSdk = traceSdk;\n        return traceSdk;\n    };\n    return BaseTrace;\n}());\nexport { BaseTrace };\n//# sourceMappingURL=baseTrace.js.map","dts":{"name":"D:/PersonalProject/fontend-trace-geekbang-course/trace-sdk/dist/types/baseTrace.d.ts","writeByteOrderMark":false,"text":"import { BaseTraceInterface } from './core/interface';\nimport { OnFetchError } from './core/fetch';\nimport { BrowserType } from './typings/common';\nexport interface TraceOptions {\n    perfOnSend: () => void;\n    perfBeforeSend: () => void;\n    dsn: string;\n    debug?: boolean;\n    appId: string;\n}\nexport declare class BaseTrace implements BaseTraceInterface {\n    dsn: string;\n    pageId: string;\n    userAgent: string;\n    browserType: BrowserType;\n    fpId: string;\n    uid: string;\n    appId: string;\n    debug: boolean;\n    perfData: TracePerf;\n    resources: TraceDataResource[];\n    result: {};\n    breadcrumb: TraceBreadcrumbs;\n    maxBreadcrumb: number;\n    breadcrumbEnabled: boolean;\n    observer: any;\n    queue: TraceData[];\n    sendTimer: number;\n    constructor(options: TraceOptions);\n    log(log: TraceDataLog): void;\n    info(message: string, tag?: string): void;\n    warn(message: string, tag?: string): void;\n    error(message: string, tag?: string): void;\n    setTraceData(data: TraceTypeData | TracePerf): TraceData;\n    send(data: TraceTypeData | TracePerf): void;\n    createPerfReport(): (metric: any) => void;\n    saveError(event: ErrorEvent): void;\n    handleObserverResource(entry: PerformanceResourceTiming): void;\n    onFetchError(message: OnFetchError): void;\n    onGlobalError(): void;\n    onGlobalClick(): void;\n    onObserverResource(): void;\n    saveBreadcrumb(data: TraceAction): void;\n    setUserId(userId: string): void;\n    static init(options: TraceOptions): BaseTrace;\n}\n"}}
